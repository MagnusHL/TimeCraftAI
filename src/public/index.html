<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TimeCraft Dashboard</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/skeleton-css/css/skeleton.css">
    <style>
        .container { padding-top: 2rem; }
        .card {
            border: 1px solid #E1E1E1;
            padding: 1rem;
            margin-bottom: 2rem;
            border-radius: 4px;
        }
        .task { margin-bottom: 1rem; }
        .overdue { color: #FF4136; }
        .refresh-time {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 2rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>TimeCraft Dashboard</h2>
        <p class="refresh-time" id="lastUpdate"></p>
        
        <div class="row">
            <div class="one-half column">
                <div class="card">
                    <h5>Verfügbare Zeit</h5>
                    <h3 id="freeTime">-</h3>
                </div>
            </div>
            <div class="one-half column">
                <div class="card">
                    <h5>Freie Zeitslots</h5>
                    <div id="timeSlots"></div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="one-half column">
                <div class="card">
                    <h5>Überfällige Aufgaben</h5>
                    <div id="tasks"></div>
                </div>
            </div>
            <div class="one-half column">
                <div class="card">
                    <h5>Heutige Termine</h5>
                    <div id="events"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function updateDashboard() {
            fetch('http://localhost:3000/api/dashboard')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('lastUpdate').textContent = 
                        `Letzte Aktualisierung: ${new Date(data.timestamp).toLocaleString()}`;
                    
                    document.getElementById('freeTime').textContent = 
                        `${data.totalFreeHours.toFixed(1)} Stunden`;
                    
                    const timeSlotsHtml = data.freeTimeSlots
                        .map(slot => `<p>${new Date(slot.start).toLocaleTimeString()} - 
                                     ${new Date(slot.end).toLocaleTimeString()}</p>`)
                        .join('');
                    document.getElementById('timeSlots').innerHTML = timeSlotsHtml;
                    
                    const tasksHtml = data.overdueTasks
                        .map(task => `<div class="task overdue">
                            <strong>${task.content}</strong><br>
                            Fällig: ${task.due?.date || 'Kein Datum'}
                        </div>`)
                        .join('');
                    document.getElementById('tasks').innerHTML = tasksHtml;
                    
                    const eventsHtml = data.events
                        .map(event => `<div class="task">
                            <strong>${event.subject || 'Termin'}</strong><br>
                            ${new Date(event.start.dateTime).toLocaleTimeString()} - 
                            ${new Date(event.end.dateTime).toLocaleTimeString()}
                        </div>`)
                        .join('');
                    document.getElementById('events').innerHTML = eventsHtml;
                })
                .catch(error => console.error('Fehler beim Laden der Daten:', error));
        }

        updateDashboard();
        setInterval(updateDashboard, 60000); // Aktualisiere jede Minute
    </script>
</body>
</html> 